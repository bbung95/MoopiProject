<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.moopi.mvc.service.payment.PaymentDao">
 	
	<resultMap id="paymentSelectMap" type="payment">
		<result property="paymentNo" 			column="PAYMENT_NO" 		jdbcType="NUMERIC"/>
		<result property="paymentRegdate"		column="PAYMENT_REGDATE" 	jdbcType="DATE" />
		<result property="paymentRole"			column="PAYMENT_ROLE" 		jdbcType="VARCHAR" />
		<result property="paymentUserId.userId" column="PAYMENT_USER_ID" 	jdbcType="VARCHAR" />
		<result property="paymentPrice" 		column="PAYMENT_PRICE" 		jdbcType="NUMERIC" />
		<result property="paymentCoinCount" 	column="PAYMENT_COIN_COUNT" jdbcType="NUMERIC" />
		<result property="paymentUid" 			column="PAYMENT_UID" 		jdbcType="VARCHAR" />
	</resultMap>
	
	

	<select id="getPayment" parameterType="int" resultMap="paymentSelectMap">
		SELECT
			PAYMENT_NO, PAYMENT_REGDATE, PAYMENT_ROLE, PAYMENT_USER_ID, PAYMENT_PRICE,
			PAYMENT_COIN_COUNT, PAYMENT_UID
			FROM Payment
		WHERE PAYMENT_NO = #{paymentNo}	
	</select>
	
 	<insert id="addPayment" parameterType="payment">
		INSERT
		INTO PAYMENT(PAYMENT_NO, PAYMENT_REGDATE, PAYMENT_ROLE, PAYMENT_USER_ID, PAYMENT_PRICE,
			PAYMENT_COIN_COUNT, PAYMENT_UID)
		VALUES(#{paymentNo}, now(), '1', #{paymentUserId.userId}, #{paymentPrice},
		#{paymentCoinCount}, #{paymentUid})
	</insert>
	
	<update id="updatePayment" parameterType="Payment">
		UPDATE PAYMENT
		<set>
			PAYMENT_ROLE = #{paymentRole},
			PAYMENT_COIN_COUNT = #{paymentCoinCount},
		</set>
		WHERE PAYMENT_NO = #{paymentNo}
	</update>
	
	<select id="paymentList" parameterType="payment" resultMap="paymentSelectMap">
		SELECT
			PAYMENT_NO , PAYMENT_USER_ID , PAYMENT_REGDATE , PAYMENT_PRICE , PAYMENT_COIN_COUNT
			FROM PAYMENT
			WHERE PAYMENT_USER_ID = #{paymentUserId.userId}
	</select>
	
	<select id="getPaymentList" parameterType="search" resultMap="paymentSelectMap">
		SELECT
			PAYMENT_NO, PAYMENT_REGDATE, PAYMENT_ROLE, PAYMENT_USER_ID, PAYMENT_PRICE,
			PAYMENT_COIN_COUNT, PAYMENT_UID
			FROM PAYMENT
			<if test="searchCondition !=null">
			<where>
			<if test="searchCondition == 1 and searchKeyword !='' ">
			PAYMENT_USER_ID = #{searchKeyword}
			</if>
			<if test="searchCondition == 2 and searchKeyword !='' ">
			PAYMENT_REGDATE = #{searchKeyword}
			</if>
			</where>
			</if>
	</select>
	
	<select  id="getTotalCount"  parameterType="search"	 resultType="int">
	  	SELECT count(*)
			FROM PAYMENT
			<if test="searchCondition != null">
			<where>
			<if test="searchCondition == 1 and searchKeyword !='' ">
			PAYMENT_USER_ID LIKE = #{searchKeyword}
			</if>
			<if test="searchCondition == 2 and searchKeyword !='' ">
			PAYMENT_REGDATE LIKE = #{searchKeyword}
			</if>
			</where>
			</if> 					
	 </select>
	
	<!-- 관리자 파트 결제 코인 등 -->
	<select id="adminPaymentList" parameterType="search" resultMap="paymentSelectMap">
		SELECT PAYMENT_NO, PAYMENT_REGDATE, PAYMENT_ROLE, PAYMENT_USER_ID PAYMENT_PRICE, 
		PAYMENT_COIN_COUNT
		FROM PAYMENT
		ORDER BY
		<choose>
			<when test="option == 'PRICE_ASC'">PAYMENT_PRICE ASC</when>
			<when test="option == 'PRICE_DESC'">PAYMENT_PRICE DESC</when>
			<when test="option == 'REGDATE_ASC'">PAYMENT_PRICE ASC</when>
			<when test="option == 'REGDATE_DESC'">PAYMENT_PRICE DESC</when>
		</choose>
	</select>
	
	
</mapper> 